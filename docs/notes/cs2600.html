<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>./notes/cs2600.md - Notes</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././src/notes/custom.css">
        <link rel="stylesheet" href=".././src/notes/katex.min.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../notes/algorithms.html"><strong aria-hidden="true">1.</strong> ./notes/algorithms.md</a></li><li class="chapter-item "><a href="../notes/arp.html"><strong aria-hidden="true">2.</strong> ./notes/arp.md</a></li><li class="chapter-item "><a href="../notes/asm.html"><strong aria-hidden="true">3.</strong> ./notes/asm.md</a></li><li class="chapter-item "><a href="../notes/basic_preproc.html"><strong aria-hidden="true">4.</strong> ./notes/basic_preproc.md</a></li><li class="chapter-item "><a href="../notes/boost_asio.html"><strong aria-hidden="true">5.</strong> ./notes/boost_asio.md</a></li><li class="chapter-item "><a href="../notes/c_codes.html"><strong aria-hidden="true">6.</strong> ./notes/c_codes.md</a></li><li class="chapter-item "><a href="../notes/classes.html"><strong aria-hidden="true">7.</strong> ./notes/classes.md</a></li><li class="chapter-item "><a href="../notes/cmake.html"><strong aria-hidden="true">8.</strong> ./notes/cmake.md</a></li><li class="chapter-item "><a href="../notes/C_notes.html"><strong aria-hidden="true">9.</strong> ./notes/C_notes.md</a></li><li class="chapter-item "><a href="../notes/compilers.html"><strong aria-hidden="true">10.</strong> ./notes/compilers.md</a></li><li class="chapter-item "><a href="../notes/concurrency.html"><strong aria-hidden="true">11.</strong> ./notes/concurrency.md</a></li><li class="chapter-item "><a href="../notes/cont_struct.html"><strong aria-hidden="true">12.</strong> ./notes/cont_struct.md</a></li><li class="chapter-item "><a href="../notes/cp_codes.html"><strong aria-hidden="true">13.</strong> ./notes/cp_codes.md</a></li><li class="chapter-item "><a href="../notes/cpp_guidelines.html"><strong aria-hidden="true">14.</strong> ./notes/cpp_guidelines.md</a></li><li class="chapter-item "><a href="../notes/cpp.html"><strong aria-hidden="true">15.</strong> ./notes/cpp.md</a></li><li class="chapter-item "><a href="../notes/cp_qs_models.html"><strong aria-hidden="true">16.</strong> ./notes/cp_qs_models.md</a></li><li class="chapter-item "><a href="../notes/cp_qs_reading.html"><strong aria-hidden="true">17.</strong> ./notes/cp_qs_reading.md</a></li><li class="chapter-item "><a href="../notes/cs2200.html"><strong aria-hidden="true">18.</strong> ./notes/cs2200.md</a></li><li class="chapter-item expanded "><a href="../notes/cs2600.html" class="active"><strong aria-hidden="true">19.</strong> ./notes/cs2600.md</a></li><li class="chapter-item "><a href="../notes/csd.html"><strong aria-hidden="true">20.</strong> ./notes/csd.md</a></li><li class="chapter-item "><a href="../notes/cv_qualifiers.html"><strong aria-hidden="true">21.</strong> ./notes/cv_qualifiers.md</a></li><li class="chapter-item "><a href="../notes/data_structures.html"><strong aria-hidden="true">22.</strong> ./notes/data_structures.md</a></li><li class="chapter-item "><a href="../notes/data_types.html"><strong aria-hidden="true">23.</strong> ./notes/data_types.md</a></li><li class="chapter-item "><a href="../notes/dhcp.html"><strong aria-hidden="true">24.</strong> ./notes/dhcp.md</a></li><li class="chapter-item "><a href="../notes/dhcpv6.html"><strong aria-hidden="true">25.</strong> ./notes/dhcpv6.md</a></li><li class="chapter-item "><a href="../notes/dns.html"><strong aria-hidden="true">26.</strong> ./notes/dns.md</a></li><li class="chapter-item "><a href="../notes/enum_classes.html"><strong aria-hidden="true">27.</strong> ./notes/enum_classes.md</a></li><li class="chapter-item "><a href="../notes/file_descriptors.html"><strong aria-hidden="true">28.</strong> ./notes/file_descriptors.md</a></li><li class="chapter-item "><a href="../notes/functions.html"><strong aria-hidden="true">29.</strong> ./notes/functions.md</a></li><li class="chapter-item "><a href="../notes/gdb.html"><strong aria-hidden="true">30.</strong> ./notes/gdb.md</a></li><li class="chapter-item "><a href="../notes/hacking_basics.html"><strong aria-hidden="true">31.</strong> ./notes/hacking_basics.md</a></li><li class="chapter-item "><a href="../notes/icmp.html"><strong aria-hidden="true">32.</strong> ./notes/icmp.md</a></li><li class="chapter-item "><a href="../notes/if_else_loops.html"><strong aria-hidden="true">33.</strong> ./notes/if_else_loops.md</a></li><li class="chapter-item "><a href="../notes/io.html"><strong aria-hidden="true">34.</strong> ./notes/io.md</a></li><li class="chapter-item "><a href="../notes/ipv4.html"><strong aria-hidden="true">35.</strong> ./notes/ipv4.md</a></li><li class="chapter-item "><a href="../notes/ipv6.html"><strong aria-hidden="true">36.</strong> ./notes/ipv6.md</a></li><li class="chapter-item "><a href="../notes/jpeg.html"><strong aria-hidden="true">37.</strong> ./notes/jpeg.md</a></li><li class="chapter-item "><a href="../notes/memory.html"><strong aria-hidden="true">38.</strong> ./notes/memory.md</a></li><li class="chapter-item "><a href="../notes/natas_levels.html"><strong aria-hidden="true">39.</strong> ./notes/natas_levels.md</a></li><li class="chapter-item "><a href="../notes/network_stack.html"><strong aria-hidden="true">40.</strong> ./notes/network_stack.md</a></li><li class="chapter-item "><a href="../notes/poe.html"><strong aria-hidden="true">41.</strong> ./notes/poe.md</a></li><li class="chapter-item "><a href="../notes/pointers.html"><strong aria-hidden="true">42.</strong> ./notes/pointers.md</a></li><li class="chapter-item "><a href="../notes/project_euler.html"><strong aria-hidden="true">43.</strong> ./notes/project_euler.md</a></li><li class="chapter-item "><a href="../notes/python.html"><strong aria-hidden="true">44.</strong> ./notes/python.md</a></li><li class="chapter-item "><a href="../notes/references.html"><strong aria-hidden="true">45.</strong> ./notes/references.md</a></li><li class="chapter-item "><a href="../notes/regex.html"><strong aria-hidden="true">46.</strong> ./notes/regex.md</a></li><li class="chapter-item "><a href="../notes/registers.html"><strong aria-hidden="true">47.</strong> ./notes/registers.md</a></li><li class="chapter-item "><a href="../notes/rust_notes.html"><strong aria-hidden="true">48.</strong> ./notes/rust_notes.md</a></li><li class="chapter-item "><a href="../notes/rvalue_refs.html"><strong aria-hidden="true">49.</strong> ./notes/rvalue_refs.md</a></li><li class="chapter-item "><a href="../notes/static_variables_and_functions.html"><strong aria-hidden="true">50.</strong> ./notes/static_variables_and_functions.md</a></li><li class="chapter-item "><a href="../notes/std_forward.html"><strong aria-hidden="true">51.</strong> ./notes/std_forward.md</a></li><li class="chapter-item "><a href="../notes/strings_arrays.html"><strong aria-hidden="true">52.</strong> ./notes/strings_arrays.md</a></li><li class="chapter-item "><a href="../notes/tcp.html"><strong aria-hidden="true">53.</strong> ./notes/tcp.md</a></li><li class="chapter-item "><a href="../notes/traceroute.html"><strong aria-hidden="true">54.</strong> ./notes/traceroute.md</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cs2600"><a class="header" href="#cs2600">cs2600</a></h1>
<h2 id="von-neumann-architecture"><a class="header" href="#von-neumann-architecture">Von Neumann Architecture</a></h2>
<p>Fetches the memory into various kinds of buffers to speed up memory fetch by CPU.</p>
<h3 id="caches"><a class="header" href="#caches">Caches</a></h3>
<p>Each core has separate L1 cache for instructions and data. L2 cache is common for both and mostly per-core (can also be shared across multiple cores). L3 cache is shared across all the cores.</p>
<h3 id="registers"><a class="header" href="#registers">Registers</a></h3>
<p>Apart from this there are also registers next to the ALU to speed up computation. More can be slower or faster depending on the number. More means lesser loads and stores. More also means longer routes (more time for pulse to travel) and clock cycle logic to choose the register become slower.</p>
<h3 id="ram-memory"><a class="header" href="#ram-memory">RAM memory</a></h3>
<ul>
<li>Has capacitors.</li>
<li>Capacitors discharge over time hence needs to be continuously powered and recharged.</li>
<li>Take time to charge and discharge, which creates bottlenecks for CPU.</li>
</ul>
<h2 id="instruction-set"><a class="header" href="#instruction-set">Instruction Set</a></h2>
<p>Different Instructions: x86, ARM, RISC V, MIPS.</p>
<ul>
<li>Programs written for one processor cannot execute on another.</li>
<li>Early trend: more instructions, complex instructions.</li>
<li>RISC – Reduced Instruction Set Computing
<ul>
<li>Instructions are small and simple</li>
<li>Software does not complicate operations.</li>
</ul>
</li>
</ul>
<h2 id="risc-v"><a class="header" href="#risc-v">RISC V</a></h2>
<p>Open source. Has 32 int and 32 FP registers. Also has XLEN variable, which is either 32 or 64 for 32-bit and 64-bit processors respectively.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Register</th><th style="text-align: center">ABI Name</th><th style="text-align: center">Description</th><th style="text-align: center">Saver</th></tr></thead><tbody>
<tr><td style="text-align: center">x0</td><td style="text-align: center">zero</td><td style="text-align: center">Zero always</td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">x1</td><td style="text-align: center">ra</td><td style="text-align: center">Return address</td><td style="text-align: center">caller</td></tr>
<tr><td style="text-align: center">x2</td><td style="text-align: center">sp</td><td style="text-align: center">Stack Pointer</td><td style="text-align: center">callee</td></tr>
<tr><td style="text-align: center">x3</td><td style="text-align: center">gp</td><td style="text-align: center">Global Pointer</td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">x4</td><td style="text-align: center">tp</td><td style="text-align: center">Thread Pointer</td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">x5-x7</td><td style="text-align: center">t0-t2</td><td style="text-align: center">Temps</td><td style="text-align: center">caller</td></tr>
<tr><td style="text-align: center">x8</td><td style="text-align: center">s0 /fp</td><td style="text-align: center">saved / frame pointer (base pointer effectively)</td><td style="text-align: center">callee</td></tr>
<tr><td style="text-align: center">x9</td><td style="text-align: center">s1</td><td style="text-align: center">saved register</td><td style="text-align: center">callee</td></tr>
<tr><td style="text-align: center">x10-x11</td><td style="text-align: center">a0-a1</td><td style="text-align: center">Fn args/ return values</td><td style="text-align: center">callee</td></tr>
<tr><td style="text-align: center">x12-x18</td><td style="text-align: center">a2-a7</td><td style="text-align: center">Fn args</td><td style="text-align: center">caller</td></tr>
<tr><td style="text-align: center">x18-x27</td><td style="text-align: center">s2-s11</td><td style="text-align: center">Saved registers</td><td style="text-align: center">callee</td></tr>
<tr><td style="text-align: center">x27-x31</td><td style="text-align: center">t3-t6</td><td style="text-align: center">Temporaries</td><td style="text-align: center">caller</td></tr>
</tbody></table>
</div>
<blockquote>
<p>Maximum memory depends on the size of the address bus from the load store unit to the memory.</p>
</blockquote>
<p>The caller saved registers have to be explicitly saved by the caller function in a stacj frame before calling the other function. On the other hand, callee saved functions are guaranteed to stay the same across function calls and there is no need for functions to save them.</p>
<h3 id="instructions"><a class="header" href="#instructions">Instructions</a></h3>
<p>The ones listed below are called <em>R-type</em> or <em>register-type</em> instructions.</p>
<ul>
<li>
<p><code>add rd, rs1, rs2</code>: add the contents of rs1 and rs2 and store it in rd. Signed addition. Also has the unsigned version. Similarly, sub, and, or, xor also exist.</p>
</li>
<li>
<p><code>mul/mulh rd, rs1, rs2</code>: multiplies and stores the lower/upper 32 bits in rd.</p>
</li>
<li>
<p><code>div/rem rd, rs1, rs2</code>: stores the quotient/remainder.</p>
</li>
<li>
<p><code>sll rd, rs1, rs2</code>: Left shift the number in rs1 by the value in rs2 and store in rd.</p>
</li>
<li>
<p><code>srl rd, rs1, rs2</code>: Right shift the number in rs1 by the value in rs2 and store in rd. Zero extends.</p>
</li>
<li>
<p><code>sra rd, rs1, rs2</code>: Right shift the number in rs1 by the value in rs2 and store in rd. Sign extends.</p>
</li>
</ul>
<p>All of these also have an immediate version where the last argument is a hardcoded literal.</p>
<p>These are called <em>I-type</em> or <em>immediate-type</em> instructions.</p>
<ul>
<li>
<p><code>l(b/h/w) rd, imm(rs1)</code>: loads a byte/half-word/word to rd(dest. register) from *(rs1 + imm)</p>
</li>
<li>
<p><code>l(b/h/w)u rd, imm(rs1)</code>: loads a byte/half-word/word to rd(dest. register) from *(rs1 + imm). This one zero-extends on the left.</p>
</li>
</ul>
<p>These are also <em>I-type</em> instructions.</p>
<p>The below one instruction is <em>S-type</em> instruction (for obvious reasons).</p>
<ul>
<li><code>s(b/h/w) rd, imm(rs1)</code>: stores a byte/half-word/word to *(rs1 + imm) from the contents of rd.</li>
</ul>
<p>The below instruction is called <em>B-type</em> or <em>branch-type</em> instruction.</p>
<ul>
<li><code>blt/bltu r1, r2, label/offset</code>: if r1 &lt; r2 (signed or unsigned), jump to label or symbol. Can jump to atmost 4 KiB. (13 bits with the lsb always 0, the rest are used for determining values).</li>
</ul>
<p>The above instructions have greater than, greater than equal to variants as well. Also immediate variants of all.</p>
<h4 id="function-calls"><a class="header" href="#function-calls">Function calls</a></h4>
<p>All of these can jump to at most 1 MiB as they take an immediate value of 20 bits apart from the lsb that’s always 0.</p>
<p>The below type is called a <em>J-type</em> instruction.</p>
<ul>
<li><code>jal rd, imm</code>: Jump to PC + imm, and store pc + 4 in register rd.</li>
</ul>
<p>The below one is an <em><strong>I-type</strong></em> and <strong>NOT</strong> J-type.</p>
<ul>
<li><code>jalr rd, rs1, imm</code>: Jump to rs1 + imm, storing PC + 4 in the register rd. Used for function pointers.</li>
</ul>
<p>Both of the ones below are aliases.</p>
<ul>
<li>
<p><code>j label</code>: alias to <code>jal zero, label</code>, discards the return address</p>
</li>
<li>
<p><code>ret rs1</code>: return to the address in rs1, if no argument is specified use ra (return addres register/x1). Alias to <code>jalr zero, rs1, 0</code></p>
</li>
</ul>
<p>For function calls we also need a stack-based execution. s2 register is the stack pointer that points to the top of the stack. Frame pointer s0 saves the base of the stack.
These mark the stack frame in the stack.</p>
<blockquote>
<p>Always load and save values relative to the frame pointer.</p>
</blockquote>
<p>Registers a0 to a7 are used to pass function arguments from one function to another. These are 8 parameters. If we have more, then you need to use the stack.</p>
<h4 id="control-and-status-registers"><a class="header" href="#control-and-status-registers">Control and status registers</a></h4>
<ul>
<li>
<p><code>csrrw rd, csr</code>: atomic swap values</p>
</li>
<li>
<p><code>csrrs rd, csr</code>: atomic read from rd and set a bit</p>
</li>
<li>
<p><code>csrrs rd, csr</code>: atomic read from rd and reset a bit</p>
</li>
<li>
<p><code>csrr rd, csr</code>: atomic read from <code>csr</code> to <code>rd</code></p>
</li>
</ul>
<p>Atomic means that interrupts won’t stop the entire set of operations that is going on.</p>
<h3 id="executing-instructions"><a class="header" href="#executing-instructions">Executing instructions</a></h3>
<p>If we are using an operating system:</p>
<ul>
<li>Proxy Kernel is handling syscalls, mapping memory, program counter according to memory map, etc.</li>
</ul>
<p>If we are without an operating system:</p>
<ul>
<li>Manually write the <code>.text</code> section to the flash memory.</li>
<li>Load the <code>.data</code> section to the RAM.</li>
<li>Set/reset the program counter to the required memory. It resets to a fixed value called as <strong>reset vector</strong>.</li>
<li>Address out of range is your skill issue.</li>
<li>Instruction fetched by the <strong>Instruction Pointer</strong>. 32 bits in width.</li>
<li>Then it is sent to control ROM. This does not have microcodes and are instead hardcoded using combinational circuit.</li>
</ul>
<h4 id="register-bank"><a class="header" href="#register-bank">Register Bank</a></h4>
<p>Has all the registers and 2 muxs + 1 demux to select the register to use. There is <em>dual porting</em> to read two source registers at once (hence two muxes).</p>
<h4 id="program-counter"><a class="header" href="#program-counter">Program Counter</a></h4>
<p>This keeps track of the next instruction to be executed. Usually incremented by 4 unless branches. It resets to a fixed value called as <strong>reset vector</strong>.</p>
<p>Instructions and data are fetched every rising edge of the clock and that is when the program counter is also incremented by 4.
The instruction fetched is later stored in the <strong>instruction register</strong>.</p>
<p>The instruction register sends it to the control unit which later sends signals to whatever is responsible.</p>
<p>It also gets reset at interrupts to an interrupt vector and begins to consume instructions from there.</p>
<h4 id="alu"><a class="header" href="#alu">ALU</a></h4>
<p>Performs arithmetic (no shit). Has the <strong>gen</strong> module before it that generates the immediate instruction from the opcode, regardless of whether it was an <em>I-type</em> or not.</p>
<p>After this, there is a 2:1 mux that has a select line coming from the Control Unit that decides whether or not the immediate values has to be selected or not, the other option being 0.</p>
<h2 id="multiprecision-arithmetic-in-riscv"><a class="header" href="#multiprecision-arithmetic-in-riscv">Multiprecision Arithmetic in RISCV</a></h2>
<p>Multiprecision addition</p>
<pre><code class="language-assembly">.data
# data goes here
iter: .word 0x2 # number of chunks
chunksize: .word 0x4 # bytes of the chunk, in this case word
var1: .word 0xffffffff
	.word 0x53535353
var2: .word 0x1
	.word 0x01010101
var3: .word 0x0
	.word 0x0

.section .text
.global main

main:
lw a1, iter 
lw a2, chunksize 
mul s1, a1, a2
xor s2, s2, s2 #i = 0
xor s3, s3, s3 #carry = 0

loop:
bgeu s2, s1, return # i &lt; k or exit

la t1, var1 #t1 = &amp;var1
add t1, t1, s2 #t1 = &amp;var1 + i
lw t1, 0(t1) #t1 = var1[i]

la t2, var2 #t2 = &amp;var2
add t2, t2, s2 #t2 = &amp;var2 + i
lw t2, 0(t2) #t2 = var2[i]

add t3, t1, t2 #sum = var1[i] + var2[i]
sltu s4, t3, t1 #first carry

add t4, t3, s3 #sum = sum + carry
sltu s5, t4, s3 #second carry

add s3, s4, s5 #final carry

la t3, var3
add t3, t3, s2
sw t4, 0(t3)

add s2, s2, a2
j loop

return:
ret
</code></pre>
<p>Multiprecision subtraction</p>
<pre><code class="language-assembly">.data
# data goes here
iter: .word 0x2 # number of chunks
chunksize: .word 0x4 # bytes of the chunk, in this case word
var1: .word 0xffffffff
	.word 0x53535353
var2: .word 0x1
	.word 0x01010101
var3: .word 0x0
	.word 0x0

.section .text
.global main

main:
lw a1, iter 
lw a2, chunksize 
mul s1, a1, a2
xor s2, s2, s2 #i = 0
xor s3, s3, s3 #carry = 0

loop:
bgeu s2, s1, return # i &lt; k or exit

la t1, var1 #t1 = &amp;var1
add t1, t1, s2 #t1 = &amp;var1 + i
lw t1, 0(t1) #t1 = var1[i]

la t2, var2 #t2 = &amp;var2
add t2, t2, s2 #t2 = &amp;var2 + i
lw t2, 0(t2) #t2 = var2[i]

sub t3, t1, t2 #sum = var1[i] - var2[i]
sgtu s4, t3, t1 #first carry

sub t4, t3, s3 #sum = sum + carry
sgtu s5, t4, t3 #second carry

add s3, s4, s5 #final carry

la t3, var3
add t3, t3, s2
sw t4, 0(t3)

add s2, s2, a2
j loop

return:
ret
</code></pre>
<p>Multiprecision multiplication</p>
<p>This is WRONG!!!!</p>
<pre><code class="language-assembly">.data
# data goes here
iter: .dword 0x2 # number of chunks
chunksize: .dword 0x8 # bytes of the chunk, in this case word
var1: .dword 0x2222222222222222
	.dword 0x0000000000003333
var2: .dword 0x10
	.dword 0x3
var3: .dword 0x0
	.dword 0x0
	.dword 0x0
	.dword 0x0

.section .text
.global main

main:
ld a1, iter 
ld a2, chunksize 
mul s1, a1, a2 #adjusting max iterations to account for chunk size
xor s2, s2, s2 #i = 0
xor s4, s4, s4 #carry = 0

outer_loop:
bgeu s2, s1, return #i &lt; k or exit

la t1, var1 #t1 = &amp;var1
add t1, t1, s2 #t1 = &amp;var1 + i
ld t1, 0(t1) #t1 = var1[i]

xor s3, s3, s3 #j = 0

inner_loop:
bgeu s3, s1, inner_end # j &lt; k or exit

la t2, var2 #t2 = &amp;var2
add t2, t2, s3 #t2 = &amp;var2 + j
ld t2, 0(t2) #t2 = var2[j]

mul t3, t1, t2 #lower bits of var1[i] * var2[j]
add t3, t3, s4 #add the previous carry here
mulh s4, t1, t2 #upper bits of var1[i] * var2[j] set as the new carry

la t4, var3 #t4 = &amp;var3
add t4, t4, s2 #t4 = &amp;var3 + i
add t4, t4, s3 #t4 = &amp;var3 + i + j

ld t5, 0(t4) #fetch whatever the previous value in that block was
add t5, t5, t3 #add the current multiplication to that value
sd t5, 0(t4) #store the final result

add s3, s3, a2 #j = j + 1
j inner_loop

inner_end:
add s2, s2, a2 #i = i + 1
j outer_loop

return:
ret
</code></pre>
<h2 id="function-call-examples-in-riscv"><a class="header" href="#function-call-examples-in-riscv">Function call examples in RISCV</a></h2>
<p>Recursive fibonacci</p>
<pre><code class="language-assembly">.data
# data goes here
fib_in: .dword 0xa #the 3rd fibonacci number
fib_out: .dword 0 #output is stored here

.section .text
.global main

main:
addi sp, sp, -0x8 #create stack frame
sd ra, 0(sp) #store return address of main
ld a0, fib_in #load the argument in the a0 reg

jal ra, fib #call the function with a0 = fib_in

la t1, fib_out #take the return value from the a1 reg 
sd a1, 0(t1) #store the return value in the required place
ld ra, 0(sp) #load the return address
addi sp, sp, 0x8 #restore stack frame
ret

fib: #fib(k)

addi sp, sp, -0x20 #make the stack frame

sd ra, 0(sp) #store the return address
sd a0, 0x8(sp) #store the argument

li t0, 2 #if a0 == 1 || a0 == 2
bleu a0, t0, fib_done #leave

addi a0, a0, -0x1 #a0 = a0 - 1
jal ra, fib #fib(k - 1)
sd a1, 0x10(sp) #t1 = fib(k-1)

addi a0, a0, -0x1 #store fib(k - 1)
jal ra, fib #fib(k - 2)
sd a1, 0x18(sp) #store fib(k - 2)

ld t1, 0x10(sp)
ld t2, 0x18(sp)
add a1, t2, t1 #a1 = fib(k - 1) + fib(k - 2)
  

ld ra, 0(sp) #restore return address
ld a0, 0x8(sp) #restore a0
addi sp, sp ,0x20 #restore stack frame
ret

fib_done:
ld ra, 0(sp) #restore return address
ld a0, 0x8(sp) #restore 
li a1, 0x1 #send value
addi sp, sp, 0x20 #restore stack frame

ret
</code></pre>
<h2 id="peripherals"><a class="header" href="#peripherals">Peripherals</a></h2>
<p>They are also mapped to the memory. And properties can be changed using that memory area.</p>
<p>The driver can be blocking or non-blocking. If blocking, it takes up a lot of CPU power as it keeps polling the peripheral for data.
If it is non-blocking, then there are interrupts then they are detected at hardware level within a clock cycle.</p>
<h3 id="interrupts"><a class="header" href="#interrupts">Interrupts</a></h3>
<p>If there is an interrupt, then the program jumps to the supplied <strong>interrupt service routine</strong> and starts executing from there and returns to the OG instruction once
everything is done.</p>
<p>Hardware interrupts are done by a bus manager like the network controller (that straight away receives a bunch of kilobytes) and use <em>DMA</em> (Direct Memory Access) to
straight away start using the memory.</p>
<p>There are software interrupts (for accessing devices like IO, sockets, etc.) and hardware interrupts for, well, other stuff.</p>
<p>Apart from that there are exceptions as well that are raised by the CPU when buttfuckery like division by 0 happens.</p>
<p>All the peripherals are connected to the <strong>PLIC</strong> (<em>Platform Level Interrupt Controller</em>). There is also <strong>CLINT</strong> (<em>Control Local Interrupt Timer</em>) that gives each core timer interrupts
that can be used a scheduler.</p>
<p>Interrupts have modes that define previlege level:</p>
<ul>
<li>Machine level: M mode, most privileged</li>
<li>Supervisor level: S mode, OS privilege</li>
<li>User level: U mode, all binaries run here</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../notes/cs2200.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../notes/csd.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../notes/cs2200.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../notes/csd.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
